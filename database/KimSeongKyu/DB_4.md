# 💡 트랜잭션이란 무엇이고 특성에 대해 설명하시오.

- 트랜잭션이란 데이터베이스의 하나의 작업 단위로, ACID특성을 만족해야 함
- 하나의 트랜잭션은 commit이나 rollback에 의해 완료됨
- 트랜잭션 상태

<img src="https://github.com/KimSeongKyu/CS_IS_ESC/blob/KimSeongKyu/database/KimSeongKyu/images/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98_%EC%83%81%ED%83%9C.png" width="600" height="400">

---

# 💡 잠금기법(Locking)에 대해 설명하시오.

- 데이터베이스의 동시성 제어를 위한 기법 중 하나로, 트랜잭션을 수행하면서 공유 데이터의 mutual exclusion을 보장하기 위해 데이터에 접근할 때 lock을 걸고 접근하는 방법
- 동시성 제어를 하지 않을 때 다음과 같은 문제 발생
    - 갱신 손실(lost update) - 두 개 이상의 트랜잭션이 하나의 데이터를 동시에 update하게 되면 하나의 트랜잭션이 다른 트랜잭션의 갱신 내용을 덮어씀
    - 현황 파악 오류(dirty read) - 하나의 데이터에 대해 어떤 트랜잭션이 쓰기 작업 중 다른 트랜잭션이 해당 데이터를 읽을 경우, 쓰기 작업 결과가 반영되지 않은 데이터를 읽게됨
    - 모순성(inconsistency) - 트랜잭션이 데이터들을 갱신하는 도중 다른 트랜잭션이 해당 데이터들을 읽는 경우, 어떤 데이터는 갱신된 값을, 어떤 데이터는 갱신되지 않은 데이터를 읽게됨
    - 연쇄 복귀(cascading rollback) - 여러 트랜잭션이 데이터를 공유하여 작업하는 도중 특정 트랜잭션이 rollback되는 경우, 다른 트랜잭션들도 함께 rollback됨

---

## Lock의 종류

- Shared-Lock(공유 잠금)
    - 특정 데이터의 읽기 권한에 대한 lock으로, 트랜잭션이 데이터를 공유 잠금 설정한 경우, 해당 트랜잭션은 해당 데이터에 대해 읽기 권한만 가짐
    - 하나의 데이터에 대해 여러 트랜잭션이 공유 잠금 가능
    - 공유 잠금이 설정된 데이터에 대해서는 다른 트랜잭션도 공유 잠금밖에 할 수 없음
- Exclusive-Lock(배타 잠금)
    - 특정 데이터의 읽기, 쓰기 권한에 대한 lock으로, 트랜잭션이 데이터를 배타 잠금 설정한 경우, 해당 트랜잭션은 해당 데이터에 대해 읽기, 쓰기 권한을 모두 가짐
    - 하나의 데이터에 대해 하나의 트랜잭션만 배타 잠금 가능
    - 배타 잠금된 데이터에 대해서는 트랜잭션이 lock을 해제하기 전까지 다른 트랜잭션 접근 불가

---

## 잠금 설정 규칙

- 데이터에 접근할 경우 Shared-Lock이나 Exclusive-Lock 둘 중 하나를 수행하여 권한을 얻어야 함
- 데이터 연산 이후에는 unlock을 통해 데이터 접근 권한을 반납해야 함

---

## 잠금 단위

- 동시성 제어에서 lock을 걸 수 있는 데이터의 단위로, 필드, 레코드, 파일, 데이터베이스 단위로 lock을 설정할 수 있음
- 잠금 단위가 클수록 동시성 수준이 낮아지고, 제어가 간단해짐
- 잠금 단위가 작을수록 동시성 수준이 높아지고, 제어가 어려움

---

# 💡 잠금 기법의 문제점에 대해서 말하시오.

- 직렬 가능한 스케쥴이 항상 보장되지 않음 → 2PL(2 Phase Locking)을 통해 해결
- 교착 상태 발생

---

## 2PL - 2 Phase Locking

- 잠금 기법을 잠금 확장 단계와 잠금 수축 단계로 나누어 수행
    - 확장 단계 - 트랜잭션이 lock을 수행할 수만 있고 unlock은 수행할 수 없는 단계
    - 수축 단계 - 트래잭션이 unlock을 수행할 수만 있고 lock은 수행할 수 없는 단계

---

# 💡 교착상태(Deadlock)란 무엇인가?

- 둘 이상의 트랜잭션이 서로가 권한을 갖고 있는 데이터의 lock을 해제하기 전에 상대방의 데이터의 접근 권한을 얻고자 할 경우, 서로가 다른 트랜잭션이 lock을 해제하기를 기다리며 대기 상태에 빠지는 현상

---

# 💡 교착상태의 빈도를 낮추는 방법에는 무엇이 있나요?

- 트랜잭션을 자주 커밋함
- 트랜잭션들이 동일한 테이블 순으로 접근하게 함
- 읽기 잠금 획득 (SELECT ~ FOR UPDATE)의 사용을 피함
- 한 테이블의 복수 행을 복수의 연결에서 순서 없이 갱신하면 교착상태가 발생하기 쉽기 때문에 테이블 단위의 잠금을 획득해 갱신을 직렬화 하면, 동시성을 떨어지지만 교착상태를 회피할 수 있음
