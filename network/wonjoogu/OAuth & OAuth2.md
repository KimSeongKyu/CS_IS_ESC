# 1. OAuth란?
* Open Authorization   
 
* **데이터를 간편하고 안전하게 주고받기(접근 위임) 위한 표준**
* **ID와 비밀번호 대신 Access Token으로 사용자를 식별**,
**다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근권한을 부여할 수 있는 공통적인 수단**    
(다양한 플랫폼에서 권한 부여를 위한 산업 표준 프로토콜).
* **토큰**은 **API를 제공하는 리소스 서버만 발급**할 수 있으며, **일정시간이 지나면 폐기**할 수 있다.
* **토큰마다 필요한 권한만 부여**할 수 있으므로, **서버가 클라이언트의 접근권한을 쉽게 제어**할 수 있다.
* ex) Authorizaion Code Grant(일반적인 소셜로그인) - 페이스북 API를 사용하는 모바일 앱의 경우
  A 사이트 접근 -> 페이스북 로그인 선택 -> 페이스북에 로그인 / 패스워드 입력 후 인증 -> A 사이트에 접근 가능한 토큰 발급 -> 인증 완료

(좀 더 자세히)
1. **Read Only 권한을 지닌 Access Token을 생성**할 수 있다. **모바일 앱이 페이스북 인증을 지원할 때 이 토큰만 발급**받는다면,
해당 모바일 앱 사용자는 **페이스북에 글을 게시할 수 없다**.
2. **사용자 ID와 비밀번호가 필요하지 않다.** 페이스북 페이지에서 로그인하면, 페이스북 측에서 해당 모바일 앱에 사용자가 승인한 권한만
있는 토근을 전달해주기 때문이다.
3. API를 사용하는 모바일 앱이 **해킹당해도 권한 도용으로 인한 손실을 최소화**할 수 있다. 
**해당 토큰을 즉각 폐기하는 식으로도 빠른 조치가 가능**하다.

### 💫 Access Token ?
* OAuth의 핵심
* 임의의 문자열 값
* 토큰을 발급해준 서비스가 알고 있다.
* Access Token을 이용해, 이 토큰값과 관련된 고객의 정보를 우리는 해당 서비스에 요청할 수 있다. 해당 서비스는 이 토큰을 검증하고,
발근된게 맞다면 해당 고객의 정보를 넘겨준다.
* 즉, Access Token의 존재 자체가 **고객이 정보를 넘겨주는 것을 동의함**이라고 할 수 있다.

<p align="center"><img src="https://media.vlpt.us/images/undefcat/post/2f54c975-f8dd-47ce-a894-4a8128091a07/image.png" width="50%" height="80%"></img></p>

* Access Token을 넘겨주면 네이버는 정보를 넘겨준다. 이걸 위해서 우리는 OAuth를 사용한다.

## 2. 작동방식과 용어

OAuth는 1.0a, 2.0 두 가지 버전이 있지만, 이름만 같을 뿐 작동방식은 판이하게 다르다.
### < 작동방식 >
* 1.0a
  * API를 사용하는 클라이언트가 **필요한 권한을 가지고 있는지 확인**하며, **Access Token을 획득한 방법까지 알 수 있다**.
  * 즉 자신을 증명하는 **인증 + 권한을 확인하는 인가 작업을 모두 수행**한다. 따라서 **2.0보다 안전**
  * 2.0에 비해 인증 과정이 복잡하고, 표준에서 요구하는 **Signature, request Token 등의 보안요소를 직접 구현**해야 하므로 **완성시간이 오래걸림**
  
* **2.0**
  * 1.0a에 있는 인증 절차가 삭제되고, 인가 절차만 있어서 사용이 쉽다. (**인증 절차 및 구현 간소화**)
  * 하지만 권한을 확인하는데 사용할 **Access Token을 어디서 얻었는지 확인할 방법이 없다**. == 가로채기 공격에 취약하다.
  * **제거된 인증 기능을 보완할 방법이 개발자의 책임**이다.
    * 대표적인 보완책 중 하나가 **HTTPS + OAuth 2.0이다**. **HTTPS의 암호화를 활용해 가로채기 공격을 막는 것**
    * 상황에 따라 Access Token의 유효기간을 분 단위로 줄이거나, 
**발급한 IP 주소에서만 토큰사용이 가능하도록 만드는 강화된 보안정책을 적용**하기도 한다.
  
### < 용어 >

* 인증(Authentication) : 자신이 누구라고 주장하는 사람을 확인하는 절차
* 권한 부여 (인가) (Authorization) : 요구하는 정보나 리소스에 접근할 수 있도록 허용하는 것
* **Resource Owner** : **리소스 서버에서 제공하는 기능을 실제로 사용할 주체**. ID와 비밀번호로 리소스 클라이언트에게 권한을 인가하여
Access Token을 얻게 될 주체. 단순히 생각하면 실 사용자. End User라고도 한다.
**Resource Server의 계정을 소유하고 있는 사용자**
* **Resource Client** : **Resource Owner에게서 사용 인가를 받아**, 소유자 대신 Access Token을 획득한 뒤 **해당 토큰으로 리소스 서버의
API를 사용하는 주체**.
  * 페이스북이나 구글 인증 기능을 사용하는 다양한 모바일 앱, 웹 서비스를 의미
  * End User의 인가가 있어야 한다. (사용자가 정보를 입력해야 인증 서버에 토큰을 요청할 수 있으니까)      
* Authorization Server (권한 서버) : Client가 Resource Server의 서비스를 사용할 수 있게 인증하고 토큰을 발행해주는 서버 (인증 서버)  
  
> 실무에서는 인가 서버 (Authorization)가 인증 서버 (Authentication) 기능을 겸하는 경우가 많음. OAuth2.0에서는 Authorization 서버라고 보는게 맞다.
  
  * **Resource Server** : **보호된 리소스를 관리**하며, **리소스 클라이언트가 사용할 API를 관리하는 주체**이다. Access Token을 요구하며, Access Token의 유효성을 확인하기 위해 인가 서버와 통신을 주고받기도 한다.
  OAuth2.0 서비스를 제공하고, 자원을 관리하는 서버 (보통 google, naver 같은 다른 사이트)

> API 호출할 때마다 토큰의 유효성을 확인하면 Authorization 서버의 부하가 커져서 비효율적이다.
> 이를 보완하기 위해 Authorization 내역을 캐싱하거나, 토큰 자체에 Authorization 내역을 확인할 수 있는 JWT를 사용하기도 한다.
 
### 과정

<p align="center"><img src="https://user-images.githubusercontent.com/50662573/109455558-466c7f80-7a9a-11eb-904f-d0d273048469.png" width="80%" height="80%"></img></p>

1. **Authorization 요청**. **리소스 클라이언트 -> Resource Owner**
    * sns 로그인 기능에서 모바일 앱이 사용자에게 로그인을 요청하는 것과 같은 맥락

2. **Authorization 코드 획득 + Access Token 요청**
    * sns 서버 (페이스북, 구글 등)에서 Authorization을 요청했던 모바일 앱으로 Authorization code를 전달
    * 공식 SDK(ex.페이스북 SDK)를 활용하면 Access Token을 바로 획득할 수도 있음
    * Authorization code를 받은 경우, 모바일 앱 측에서 해당 코드를 Access Token으로 변환하는 작업을 해야 한다.
    * 모바일 앱 측에서는 토큰을 받은 뒤, 해당 토큰이 적절한 권한 scope를 가지고 있는지 확인하기도 한다.

3. **Secured Resource 요청**
    * 발급받은 Access Token을 활용해서 API 요청
